# S1-ALIGNMENT (对齐阶段)

## 1. 项目上下文分析
* **技术栈**: C++11, Qt 5.10+/Qt 6, Eigen 5.0.0-dev, CMake.
* **架构模式**: 插件化/库驱动架构，核心功能由多个库（fiff, mne, utils, disp等）提供。
* **依赖关系**: 强依赖于 Qt 信号槽机制和 Eigen 矩阵运算。
* **业务域**: 脑电图(EEG)和脑磁图(MEG)数据处理。

## 2. 需求理解确认
* **原始需求**: 修复当前存在的19个单元测试失败。
* **边界确认**: 
    * 仅针对当前环境下的测试失败进行修复。
    * 涉及测试数据缺失、代码逻辑错误（如 Eigen API 变更引起的问题）以及内存错误（SIGSEGV）。
* **需求理解**:
    * 许多测试由于找不到 `resources/data` 目录下的测试文件而失败。
    * 部分测试由于 Eigen 5.0.0-dev 对 1D 索引的严格检查而报错。
    * 部分测试存在段错误（SIGSEGV），可能与空指针或未初始化的对象有关。

## 3. 智能决策与疑问澄清
* **决策点 1**: 测试数据是否必须完整？
    * **决策**: 是。单元测试依赖于特定的 `.fif` 文件。已启动数据下载脚本。
* **决策点 2**: 如何处理 Eigen API 变更？
    * **决策**: 统一将 `.array()(i)` 或 `.data()[i]` 风格的 1D 访问修改为符合 Eigen 新标准的 2D 坐标访问 `(r, c)` 或确保使用 `.data()` 指针进行合法偏移。
* **决策点 3**: 优先修复哪类错误？
    * **决策**: 优先解决数据缺失，因为这可能掩盖了真正的逻辑错误。随后解决崩溃（SIGSEGV）。

## 4. 验收标准
* 所有单元测试在 `ctest` 中通过。
* 代码改动符合现有项目的代码风格。
* 不引入新的内存泄漏或崩溃。
